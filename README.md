# netomox-examples

RFC8345-based network topology data and helper tool for its development.

## Project setup (Viewer)

### Initial setup for netoviz

Clone and install [netoviz](https://github.com/corestate55/netoviz) (as submodule) at first,
because `Rakefile` saves topology datafiles to `netoviz/static/model` directory.

```bash
git submodule update --init --recursive
```

Install its packages.

```bash
cd netoviz/
npm install
```

### Update netoviz

Update repository
```bash
git submodule foreach git pull origin develop
```

and exec `npm install` if necessary.

### Run netoviz

Run viewer app.
(development mode, see [netoviz README](https://github.com/corestate55/netoviz) more detail.)

```bash
npm run dev
```

Netoviz visualize model data that generated by here.

## Project setup (Topology DSL Library)

Install [netomox](https://github.com/corestate55/netomox)
(See [netomox DSL page](https://github.com/corestate55/netomox/blob/develop/dsl.md) about data definition DSL.)

```bash
bundle install path=vendor/bundle
```

## Edit/Convert model data

### Model data script

Model files are at `./model_defs/`. 
There are several rules for scripts below:

* `./model_defs/foo.rb`
  * requires scripts which defines sub-topology data from under 1-depth subdirectories
    (like `./model_defs/bar/baz.rb`, see [Guardfile](./Guardfile))
  * outputs data to STDOUT as JSON data.
    It saved as same basename json file in netoviz script directory.
    (`netoviz/static/model/foo.json`, see [Rakefile](./Rakefile))
  * outputs description string with `-d` option. (It used to make index file.)

Additional info:

* [batfish trial (L3)](./model_defs/bf_l3trial/info.md): A trial to generate topology data using batfish (for L3 network)
* [batfish trial (L2)](./model_defs/bf_l2trial/info.md): A trial for L2 Network

### Topology data generation

Generate (All) topology data files

```bash
bundle exec rake
```

Specify a target file to generate using `TARGET` environment variable.

```bash
bundle exec rake TARGET=./model_defs/hoge.rb
```

### Watch script and generate data automatically

It can watch files and exec data generate command automatically when a file edited (saved).

```bash
# watch ./model_defs/foo.rb and files it requires.
bundle exec guard -g ./model_defs/hoge.rb
```

## Edit layout data
`model_defs/layout/foo-layout.json` is layout file of `model_defs/layout/foo.rb`
(it make topology data as `foo.json`).

NOTICE:
* layout files are not watched by `guard` (currently).
* `rake` install corresponding layout file when topology data (json) is generated from model def script.

## Generate Netoviz index
```bash
bundle exec rake make_idnex
```
`make_index` rake task generate index file for netoviz. (It makes `netoviz/static/model/_index.json` directly.)
If a model def script is added in `model_defs/`, exec 'rake make_index' to generate new index.
